# TIL for 2025 02 12

# 公式イベントでお話させていただきます:bangbang: :partyparrot: :partyparrot: :partyparrot:

[こちらの公式イベント](https://school.runteq.jp/v2/runteq_events/1286)で受講生代表＋お便りを募集するアプリの制作者という形でお話をさせていただくことになりました！

強い人達に交じって僕なりの考えや経験したことをお話して、皆さんに共有できればなと思っているので、ぜひご参加ください！

# 公式イベントへのお便りを「Music Hour」で大募集中！お便り求ム！！:email:

上記のイベント内で使用する「生徒からの声」を僕の卒業制作[Music Hour](https://school.runteq.jp/v3/social_portfolios/1272/web_applications/247)を使って募集しています！
マジで全然集まってないので、どうか！！よろしくお願いします！！（現在総お便り数：２）

ほんとになんでも聞きたいことやご意見を募集しているみたいなので、「自分なんて・・・」と思わずに何でもかんでもAIに関すること投稿しちゃってください！

ユーザー登録なしでもページにアクセスすればすぐに投稿できます！

## お便りはこちらから！よろしくお願いします！！　→　https://nanigaderukana.onrender.com/programs/15

※使いにくいとかどうやって投稿するかとか分からんって思ったらすぐ僕に連絡ください。使いにくいとこ修正します！！

---


## 2/12 今日やったこと！

- イベント２件立てたぞー
- 週一のキャリコン面談
- LT会登壇資料用のお遊び

## - オールナイトランテック第２回＆外伝イベント立てたよ！

### 第２回 2/23（日）20:00 ～
https://school.runteq.jp/v2/runteq_events/1291

#### 第２回は以下の３つでお便り募集中 :bangbang: :email: 
「ここがすごいよRUNTEQオフ会！！」  
「こんなイベントやってくれ！！」  
「先輩！！カリキュラムの進め方を教えてください！！」  
#### お便りはこちらから！ → https://nanigaderukana.onrender.com/programs/10  

### 外伝 3/1（土）20:00 ～
https://school.runteq.jp/v2/runteq_events/1290

### お便りは登録しなくても送信できます！テーマに沿っていれば誰でもOKなのでどんどんお便り送ってください！！

#### [こちらの公式イベント](https://school.runteq.jp/v2/runteq_events/1286)もお便り募集中 :bangbang: :email: (現在５件) → https://nanigaderukana.onrender.com/programs/15

---

### - 週一のキャリコン面談

先週は結構予定ギチギチでキャンセルしてしまったので今週はきちんと行ってきました。なんやかんや２週間分だったのでサボり気味とはいえ結構話すこと多かったです。

新年会でいろんな人に認知されてることを痛感してやる気が戻ってきたとか、新しい期の方たちにも結構認知されたりしてるので手本になるように動こうと思ってるとか、最近の不調の原因はほとんど取り除けたのでこれからは勉強のメリハリとリズムを取り戻すのが目標だとか、そんな話をしました。

明日からは９時か１０時ぐらいから初めて１８時ぐらいまでしっかりプログラミングできればいいなと思ってます。プログラミングはプログラミングやる時間、休憩は休憩する時間、遊ぶのは遊ぶ時間。しっかりメリハリつけてやっていこうと思います。

### - LT会登壇資料用のお遊び

寝るまでに２時間ほど[このLT会](https://school.runteq.jp/v2/runteq_events/1284)用の登壇資料書くためにエイリアスとシェルスクリプトで遊んでました。

ここでアウトプットしちゃうとネタ尽きちゃうので書きませんが、結構実用的な話ができるんじゃないかなと思います。本番までにいっぱい人呼んどいて！これ広めると結構いろんな人が幸せになると思う！！

---

### - 技術のアウトプット ActiveStorageの話

ActiveStorageってのはこういうものです↓  
https://railsguides.jp/active_storage_overview.html  
https://qiita.com/nagumo01/items/76b97a98e83604150496

簡単に言うとレコード一つに対して画像とか動画とかを一つとか複数とかを関連付けて簡単に保存できるってものですね。設定さえすれば、専用のテーブル作ってURL保存してマウント、みたいなことをしなくても必要なことをRailsが自動でやってくれるってやつです。

このActiveStorageで画像保存する場合なんですが、例えばuserのプロフィール画像とか保存したい。ってなった場合に

user  ---  ActiveStorageが用意する中間テーブル（ポリモーフィック関連付け） ---  画像

みたいな感じでuserと画像の関係が中間テーブルに保存され、それを通してuserに関連づいてる画像引っ張ってこれたりプロフィールに表示したりってことができるようになります。ポリモーフィック関連付けに関しては今回あんまり関係ないので割愛します。調べてみそ、おもろいから。

んでもってこの画像を削除する時が面白いんですよ。

ActiveStorageを使って保存した画像を消すときはpurgeというメソッドを使います。

```ruby
image = @user.profile_image
image.purge
```

こんな風に書くとします。すると結構まずいことになります。それはなぜでしょうか！！ちょっとここでスクロールやめて考えてみてください。

答えは出ましたか？

まず、これを実行するとどうなるかですが、

```ruby
@user.profile_image.attached?
# => true
```

`attached?`はActiveStorageで関連付けられたものが保存されているか確認するメソッドです。なぜか削除したはずなのにtrueになってますよね？

ですが実際には画像は存在してません。`@user.profile_image`をviewとかで呼び出すとエラーになります。あらふしぎ。

実は、なんですけど上記のように一度`image`のように変数に保存して、そいつに対してpurgeを行うと、profile_imageのインスタンスに対してpurgeを行うことになるので以下のようなイメージで画像だけが削除されてしまい、「関連付けされているよ！」っていう情報を持ってる中間テーブルのレコードが削除されずに残ってしまうんです。

user  ---  ActiveStorageが用意する中間テーブル（ポリモーフィック関連付け） ---  ~~画像~~

`@user.profile_image.attached?`とすると中間テーブルで関連付けされている情報があるかを探すので`true`になってしまいますが、実際のところ、画像はpurgeされてしまっているので存在しないということになるのです。

なのできちんと中間テーブルからも「関連付けされてるよ！」という情報も削除し、画像も削除するようにするには以下のように記述しなければいけません。

```ruby
@user.profile_image.purge
```

こうするとuserとprofile_imageの関係性をたどってpurgeすることができるので中間テーブルのレコードもきっちり削除されます。もしくは中間テーブルに対して削除の命令を出すかですね。（これも調べてね）。

代入する前にpurgeすると関連付けの経路も辿れる。代入してからpurgeしてしまうとインスタンスだけに対してpurgeを行うからうまく関連付けの情報をたどれず中間テーブルに情報が残ってしまうこともあるってことでした。ActiveStorage使うときは気を付けてね！！

---

とりま明日は９時ぐらいには起きて１０時から勉強初めて脇目もふらず１８ぐらいまで完走したいですね。イベント関連の準備も終わって１８日までは予定ないのでクソほど遅れてるissueを全力で潰していきます。同時にプログラミングの週間も戻したいね、メリハリのある学習をできるように！！

Music Hourをガチでいじってた１週間の１日１６時間できてたぐらいのゾーンには入れたら最高、頑張ります。
